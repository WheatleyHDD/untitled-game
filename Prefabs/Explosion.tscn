[gd_scene load_steps=80 format=2]

[ext_resource path="res://Sprites/explosion/ezgif-frame-014.png" type="Texture" id=1]
[ext_resource path="res://Sprites/explosion/ezgif-frame-012.png" type="Texture" id=2]
[ext_resource path="res://Sprites/explosion/ezgif-frame-060.png" type="Texture" id=3]
[ext_resource path="res://Sounds/explosion.wav" type="AudioStream" id=4]
[ext_resource path="res://Sprites/explosion/ezgif-frame-062.png" type="Texture" id=5]
[ext_resource path="res://Sprites/explosion/ezgif-frame-050.png" type="Texture" id=6]
[ext_resource path="res://Sprites/explosion/ezgif-frame-047.png" type="Texture" id=7]
[ext_resource path="res://Sprites/explosion/ezgif-frame-046.png" type="Texture" id=8]
[ext_resource path="res://Sprites/explosion/ezgif-frame-042.png" type="Texture" id=10]
[ext_resource path="res://Sprites/explosion/ezgif-frame-005.png" type="Texture" id=11]
[ext_resource path="res://Sprites/explosion/ezgif-frame-006.png" type="Texture" id=12]
[ext_resource path="res://Sprites/explosion/ezgif-frame-003.png" type="Texture" id=13]
[ext_resource path="res://Sprites/explosion/ezgif-frame-055.png" type="Texture" id=14]
[ext_resource path="res://Sprites/explosion/ezgif-frame-040.png" type="Texture" id=15]
[ext_resource path="res://Sprites/explosion/ezgif-frame-032.png" type="Texture" id=16]
[ext_resource path="res://Sprites/explosion/ezgif-frame-054.png" type="Texture" id=17]
[ext_resource path="res://Sprites/explosion/ezgif-frame-066.png" type="Texture" id=18]
[ext_resource path="res://Sprites/explosion/ezgif-frame-065.png" type="Texture" id=19]
[ext_resource path="res://Sprites/explosion/ezgif-frame-064.png" type="Texture" id=20]
[ext_resource path="res://Sprites/explosion/ezgif-frame-063.png" type="Texture" id=21]
[ext_resource path="res://Sprites/explosion/ezgif-frame-035.png" type="Texture" id=22]
[ext_resource path="res://Sprites/explosion/ezgif-frame-048.png" type="Texture" id=23]
[ext_resource path="res://Sprites/explosion/ezgif-frame-023.png" type="Texture" id=24]
[ext_resource path="res://Sprites/explosion/ezgif-frame-022.png" type="Texture" id=25]
[ext_resource path="res://Sprites/explosion/ezgif-frame-010.png" type="Texture" id=26]
[ext_resource path="res://Sprites/explosion/ezgif-frame-061.png" type="Texture" id=30]
[ext_resource path="res://Sprites/explosion/ezgif-frame-053.png" type="Texture" id=31]
[ext_resource path="res://Sprites/explosion/ezgif-frame-007.png" type="Texture" id=34]
[ext_resource path="res://Sprites/explosion/ezgif-frame-027.png" type="Texture" id=36]
[ext_resource path="res://Sprites/explosion/ezgif-frame-031.png" type="Texture" id=37]
[ext_resource path="res://Sprites/explosion/ezgif-frame-036.png" type="Texture" id=38]
[ext_resource path="res://Sprites/explosion/ezgif-frame-070.png" type="Texture" id=39]
[ext_resource path="res://Sprites/explosion/ezgif-frame-015.png" type="Texture" id=40]
[ext_resource path="res://Sprites/explosion/ezgif-frame-020.png" type="Texture" id=41]
[ext_resource path="res://Sprites/explosion/ezgif-frame-018.png" type="Texture" id=42]
[ext_resource path="res://Sprites/explosion/ezgif-frame-009.png" type="Texture" id=43]
[ext_resource path="res://Sprites/explosion/ezgif-frame-041.png" type="Texture" id=44]
[ext_resource path="res://Sprites/explosion/ezgif-frame-057.png" type="Texture" id=45]
[ext_resource path="res://Sprites/explosion/ezgif-frame-052.png" type="Texture" id=47]
[ext_resource path="res://Sprites/explosion/ezgif-frame-067.png" type="Texture" id=49]
[ext_resource path="res://Sprites/explosion/ezgif-frame-073.png" type="Texture" id=53]
[ext_resource path="res://Sprites/explosion/ezgif-frame-072.png" type="Texture" id=54]
[ext_resource path="res://Sprites/explosion/ezgif-frame-071.png" type="Texture" id=55]
[ext_resource path="res://Sprites/explosion/ezgif-frame-058.png" type="Texture" id=56]
[ext_resource path="res://Sprites/explosion/ezgif-frame-034.png" type="Texture" id=57]
[ext_resource path="res://Sprites/explosion/ezgif-frame-039.png" type="Texture" id=58]
[ext_resource path="res://Sprites/explosion/ezgif-frame-021.png" type="Texture" id=59]
[ext_resource path="res://Sprites/explosion/ezgif-frame-051.png" type="Texture" id=60]
[ext_resource path="res://Sprites/explosion/ezgif-frame-025.png" type="Texture" id=61]
[ext_resource path="res://Sprites/explosion/ezgif-frame-056.png" type="Texture" id=63]
[ext_resource path="res://Sprites/explosion/ezgif-frame-028.png" type="Texture" id=66]
[ext_resource path="res://Sprites/explosion/ezgif-frame-074.png" type="Texture" id=71]
[ext_resource path="res://Sprites/explosion/ezgif-frame-017.png" type="Texture" id=74]
[ext_resource path="res://Sprites/explosion/ezgif-frame-033.png" type="Texture" id=75]
[ext_resource path="res://Sprites/explosion/ezgif-frame-044.png" type="Texture" id=77]
[ext_resource path="res://Sprites/explosion/ezgif-frame-049.png" type="Texture" id=78]
[ext_resource path="res://Sprites/explosion/ezgif-frame-038.png" type="Texture" id=79]
[ext_resource path="res://Sprites/explosion/ezgif-frame-037.png" type="Texture" id=80]
[ext_resource path="res://Sprites/explosion/ezgif-frame-004.png" type="Texture" id=81]
[ext_resource path="res://Sprites/explosion/ezgif-frame-069.png" type="Texture" id=83]
[ext_resource path="res://Sprites/explosion/ezgif-frame-068.png" type="Texture" id=84]
[ext_resource path="res://Sprites/explosion/ezgif-frame-011.png" type="Texture" id=85]
[ext_resource path="res://Sprites/explosion/ezgif-frame-019.png" type="Texture" id=86]
[ext_resource path="res://Sprites/explosion/ezgif-frame-013.png" type="Texture" id=88]
[ext_resource path="res://Sprites/explosion/ezgif-frame-016.png" type="Texture" id=89]
[ext_resource path="res://Sprites/explosion/ezgif-frame-008.png" type="Texture" id=90]
[ext_resource path="res://Sprites/explosion/ezgif-frame-043.png" type="Texture" id=91]
[ext_resource path="res://Sprites/explosion/ezgif-frame-059.png" type="Texture" id=92]
[ext_resource path="res://Sprites/explosion/ezgif-frame-030.png" type="Texture" id=93]
[ext_resource path="res://Sprites/explosion/ezgif-frame-029.png" type="Texture" id=94]
[ext_resource path="res://Sprites/explosion/ezgif-frame-076.png" type="Texture" id=96]
[ext_resource path="res://Sprites/explosion/ezgif-frame-026.png" type="Texture" id=99]
[ext_resource path="res://Sprites/explosion/ezgif-frame-024.png" type="Texture" id=100]
[ext_resource path="res://Sprites/explosion/ezgif-frame-045.png" type="Texture" id=101]

[sub_resource type="Shader" id=1]
code = "shader_type canvas_item;
render_mode blend_mix;

uniform bool use_mult;
uniform float key_distance : hint_range(0, 1);
uniform vec4 chroma_key : hint_color;
uniform vec4 color : hint_color;

void fragment() {
  COLOR = texture(TEXTURE, UV);

  if (distance(COLOR, chroma_key) < key_distance) {
    if (use_mult) {
      COLOR =  COLOR * color;      
     }
    else {
      COLOR = color;
     }
   }
}"
custom_defines = ""

[sub_resource type="ShaderMaterial" id=2]
shader = SubResource( 1 )
shader_param/use_mult = true
shader_param/key_distance = 0.75
shader_param/chroma_key = Color( 0, 1, 0, 1 )
shader_param/color = Color( 0, 0, 0, 0 )

[sub_resource type="SpriteFrames" id=3]
animations = [ {
"frames": [ ExtResource( 13 ), ExtResource( 81 ), ExtResource( 11 ), ExtResource( 12 ), ExtResource( 34 ), ExtResource( 90 ), ExtResource( 43 ), ExtResource( 26 ), ExtResource( 85 ), ExtResource( 2 ), ExtResource( 88 ), ExtResource( 1 ), ExtResource( 40 ), ExtResource( 89 ), ExtResource( 74 ), ExtResource( 42 ), ExtResource( 86 ), ExtResource( 41 ), ExtResource( 59 ), ExtResource( 25 ), ExtResource( 24 ), ExtResource( 100 ), ExtResource( 61 ), ExtResource( 99 ), ExtResource( 36 ), ExtResource( 66 ), ExtResource( 94 ), ExtResource( 93 ), ExtResource( 37 ), ExtResource( 16 ), ExtResource( 75 ), ExtResource( 57 ), ExtResource( 22 ), ExtResource( 38 ), ExtResource( 80 ), ExtResource( 79 ), ExtResource( 58 ), ExtResource( 15 ), ExtResource( 44 ), ExtResource( 10 ), ExtResource( 91 ), ExtResource( 77 ), ExtResource( 101 ), ExtResource( 8 ), ExtResource( 7 ), ExtResource( 23 ), ExtResource( 78 ), ExtResource( 6 ), ExtResource( 60 ), ExtResource( 47 ), ExtResource( 31 ), ExtResource( 17 ), ExtResource( 14 ), ExtResource( 63 ), ExtResource( 45 ), ExtResource( 56 ), ExtResource( 92 ), ExtResource( 3 ), ExtResource( 30 ), ExtResource( 5 ), ExtResource( 21 ), ExtResource( 20 ), ExtResource( 19 ), ExtResource( 18 ), ExtResource( 49 ), ExtResource( 84 ), ExtResource( 83 ), ExtResource( 39 ), ExtResource( 55 ), ExtResource( 54 ), ExtResource( 53 ), ExtResource( 71 ), ExtResource( 96 ) ],
"loop": false,
"name": "default",
"speed": 90.0
} ]

[sub_resource type="GDScript" id=4]
script/source = "extends AnimatedSprite


# Declare member variables here. Examples:
# var a = 2
# var b = \"text\"


# Called when the node enters the scene tree for the first time.
func _ready():
	set_meta(\"name\", \"Explosion\")
	$explosion.play()


# Called every frame. 'delta' is the elapsed time since the previous frame.
func _process(delta):
	if get_tree().get_current_scene().get_node_or_null(\"Player\"):
		$explosion.volume_db = -80 / position.distance_to(get_tree().get_current_scene().get_node_or_null(\"Player\").position)
#		print(-80 / position.distance_to(get_tree().get_current_scene().get_node_or_null(\"Player\").position))

func _on_Area2D_body_entered(body):
	if body.has_meta(\"name\") and is_playing():
		match body.get_meta(\"name\"):
			\"Player\":
				randomize()
				body.hp -= rand_range(50, 70)
			\"Enemy\":
				randomize()
				body.hp -= rand_range(70, 100)


func _on_Explosion_animation_finished():
	playing = false
"

[sub_resource type="RectangleShape2D" id=5]
extents = Vector2( 439.088, 250.192 )

[node name="Explosion" type="AnimatedSprite"]
material = SubResource( 2 )
scale = Vector2( 0.3, 0.3 )
frames = SubResource( 3 )
script = SubResource( 4 )

[node name="Area2D" type="Area2D" parent="."]

[node name="CollisionShape2D" type="CollisionShape2D" parent="Area2D"]
shape = SubResource( 5 )

[node name="explosion" type="AudioStreamPlayer" parent="."]
stream = ExtResource( 4 )
bus = "Sound"
[connection signal="animation_finished" from="." to="." method="_on_Explosion_animation_finished"]
[connection signal="body_entered" from="Area2D" to="." method="_on_Area2D_body_entered"]
